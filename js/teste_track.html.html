<!DOCTYPE html>
<html>
<head>
    <title>Rastreamento Simples (Google Forms com Imagem)</title>
    <script>
        // preencha com os seus valores
        const GOOGLE_FORM_ID = '1FAIpQLSdqHYhzTJ76BxeOCx6KyoHLdlREXT2pV3L8ZtGnwi196eDYFw';
        const USER_ID_FIELD = 'entry.1813536727';
        const DATE_FIELD = 'entry.1872388821';
        const URL_FIELD = 'entry.1750221224';
        const BUTTON_TYPE_FIELD = 'entry.879030890';
        const UTMS_FIELD = 'entry.1931566672';

        // Gera um ID único para o usuário (UUID)
        function generateUUID() {
             return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
               var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
             });
        }

        // Verifica e cria o user_id
        function getUserId() {
             let userId = localStorage.getItem('user_id');
            if (!userId) {
               userId = generateUUID();
                 localStorage.setItem('user_id', userId);
               }
            return userId;
       }

         // Envia os dados para o Google Forms usando uma imagem
         function sendToGoogleForm(data) {
            const formURL = `https://docs.google.com/forms/d/e/${GOOGLE_FORM_ID}/formResponse?`;
             const params = new URLSearchParams();
               params.append(USER_ID_FIELD, data.user_id);
             params.append(DATE_FIELD, data.date);
              params.append(URL_FIELD, data.url);
            params.append(BUTTON_TYPE_FIELD, data.button_type);
               params.append(UTMS_FIELD, JSON.stringify(data.utms));
             const imageURL = formURL + params.toString();
             const img = new Image();
            img.onload = () => console.log("Imagem carregada");
            img.onerror = (error) => console.error("Erro ao carregar imagem:", error);
            img.src = imageURL;
        }


        // Função principal de rastreamento
        function trackEvent(eventType, buttonType = 'NA') {
           const now = new Date().toISOString();
            const url = window.location.href;
             const userId = getUserId();
            const utms = {};

            // Pega os UTMs
            const urlParams = new URLSearchParams(window.location.search);
            for (const [key, value] of urlParams.entries()) {
                if (key.startsWith('utm_')) {
                     utms[key] = value;
                }
            }
          const data = {
              user_id: userId,
                date: now,
               url: url,
              button_type: buttonType,
                 utms: utms,
          };

          sendToGoogleForm(data);
     }


      document.addEventListener('DOMContentLoaded', () => trackEvent('page_visit'));

        document.addEventListener('click', function(event) {
           let buttonType = 'NA'
            if (event.target.tagName === 'A') {
                 const destino = event.target.href;
                   if (destino.includes('kirvano') || destino.includes('kiwify') || destino.includes('stripe') || destino.includes('hotmart')) {
                         buttonType = "iniciate_checkout";
                    }else if(destino.includes('/legal/')){
                        buttonType = "politica_privacidade";
                   }

            } else if(event.target.tagName === 'BUTTON'){
                   if(event.target.onclick && event.target.onclick.toString().includes("window.location.href='")){
                      const hrefMatch = event.target.onclick.toString().match(/window\.location\.href='(.*?)'/);
                        if(hrefMatch){
                             const destino = hrefMatch[1];
                                if (destino.includes('kirvano') || destino.includes('kiwify') || destino.includes('stripe') || destino.includes('hotmart')) {
                                     buttonType = "iniciate_checkout";
                                   } else{
                                       buttonType = "ver_preco";
                                   }
                           }

                 }else if (event.target.onclick && event.target.onclick.toString().match(/scrollIntoView\({behavior: 'smooth'}\)\'/)){
                     buttonType = "ver_preco"
                     }else{
                       buttonType = "teste_gratis"
                    }
           }else{
                return
            }

            trackEvent('click', buttonType)
        });
    </script>
</head>
<body>
    <h1>Minha Página</h1>
    <a href="https://kirvano.com/checkout/..." target="_blank">Comprar Agora</a>
    <a href="/legal/politica-de-privacidade">Política de Privacidade</a>
    <button>teste aqui</button>
    <button onclick="document.getElementById('feature-1').scrollIntoView({behavior: 'smooth'})">Ver mais</button>
    <button>Teste Grátis</button>
    <div id="feature-1">
        <h2>Feature 1</h2>
    </div>
</body>
</html>